version: 2

orbs:
  sauce-connect: saucelabs/sauce-connect@1.0.1
jobs:  
  build:  
    docker:  
      - image: circleci/node:lts
    steps: 
      - checkout
      - run: 
          name: Build
          command: npm install
      - run:
          name: Run Unit Tests
          command: echo 127.0.0.1 devhost | sudo tee -a /etc/hosts
      - run: 
          name: Local Deploy
          command: npm start & sleep 60
      - run: 
          name: Run Functional Tests
          command: npm run test-wdio
	  tunnel_identifer: 'circleTunnel'
      - run:
          name: Pre-Release
          command: npm run predeploy
      - run:
          name: Release
          command: npm run deploy